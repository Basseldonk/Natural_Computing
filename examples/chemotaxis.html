<!DOCTYPE html>
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<script src="../build/cpm.js"></script>
<script src="fpsmeter.min.js"></script>
<style type="text/css">
	canvas{ border: 1px solid black}
</style>
</head>
<body>
<script>
"use strict"

let w = 600, h=600, m=h/2, D = 0.1, meter

var g = new CPM.Grid2D([w/10,h/10], true, "Float32"),
	gi = new CPM.CoarseGrid( g, 10 ),
	C = new CPM.CPM([w,h], {T:20, torus: true})

C.add( new CPM.Adhesion( { J: [[0,20], [20,100]] } ) )
C.add( new CPM.VolumeConstraint( { V: [0,250], 
	LAMBDA_V: [0,50] } ) )
C.add( new CPM.ChemotaxisConstraint( { field: gi, LAMBDA_CH: [0, 800] } ) )

new CPM.GridManipulator(C).seedCellAt(1, [200,m])

var Ci = new CPM.Canvas(C,{zoom:1})

let center = [w/10/2,h/10/2]

//g.setpix( center, 1e6 )

//console.log( g.gradient( [w/10/2-1,h/10/2-1] ) )

let t = 5000

meter = new FPSMeter({left:"auto", right:"5px"})

function timestep(){
	meter.tickStart()
	g.setpix( center, 100+g.pixt(center) )
	for( let i = 1 ; i <= 10 ; i ++ ){
		g.diffusion( D )
	}
	g.multiplyBy( 0.9 )
	C.monteCarloStep()
	meter.tick()
	if( t % 5 == 0 ){
		Ci.drawField( gi )
		Ci.drawCellBorders( -1, "FFFFFF" )
	}
	if( t-- > 0 ){
		requestAnimationFrame( timestep )
	}
}

timestep()

</script>
</body>
</html>
