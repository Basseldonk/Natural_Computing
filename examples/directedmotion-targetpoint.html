<!DOCTYPE html>
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<script src="../build/cpm.js"></script>
<script src="fpsmeter.min.js"></script>
<script>
"use strict"

let C, Cdir, Cim, Cm, w = 200, zoom = 2, meter, t = 0

function draw(){
	// Clear the canvas and redraw:
	Cim.clear( "EEEEEE" )
	// Draw cell in black with gray borders
	Cim.drawCells( 1, "000000" )
	Cim.drawOnCellBorders( 1, "666666" )
}

function timestep(){
	// Update the grid with one MCS
	C.timeStep()
	C.timeStep()
	C.timeStep()
	meter.tick()
	if( t++ % 2 == 0 ){
		draw()
	}
	requestAnimationFrame( timestep )
}

function seedGrid(){
	// Seed 1 cell
	for( let i = 0 ; i < Math.PI*2 ; i += 0.4 ){
		Cm.seedCellAt( 1, [Math.round(w/2+w/3*Math.sin(i)),Math.round(w/2+w/3*Math.cos(i))] )
	}
}

function initialize(){
	// Create a new CPM, canvas, and stats object
	C = new CPM.CPM( [w,w], {
		torus : true,
		seed : 2,
		nCellKinds : 1,
		LAMBDA_CONNECTIVITY : [0,1000],
		T : 20,
		J : [ 
		 	[0,20],
			[20,1000]
		],
		LAMBDA_V : [0,50],
		V : [0,152],
	})

	C.add( new CPM.Adhesion( C.conf ) )
	C.add( new CPM.VolumeConstraint( C.conf ) )

	Cdir = new CPM.AttractionPointConstraint({
		LAMBDA_ATTRACTIONPOINT : [0,100],
		ATTRACTIONPOINT : [[0,0], [w/2,w/2] ] 
	})

	C.add( Cdir )


	Cim = new CPM.Canvas( C, {zoom:zoom} )
	Cm = new CPM.GridManipulator( C )
	// Start simulation

	seedGrid()

	for( let i = 0 ; i < 20 ; i ++ ){
		C.timeStep()
	}

	meter = new FPSMeter({left:"auto", right:"5px"})

	timestep()
}
</script>
</head>
<body onload="initialize()">
<p>Cell moving towards a target point.</p>
</body>
</html>
