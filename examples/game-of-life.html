<!DOCTYPE html>
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<script src="../build/cpm.js"></script>
<script src="fpsmeter.min.js"></script>
<style type="text/css">
	canvas{ border: 1px solid black}
</style>

<script>
"use strict"

let C, zoom=4, Cim, cid=0, w=200, meter

function draw(){
	// Clear the canvas (in the backgroundcolor white), and redraw:
	Cim.clear( "FFFFFF" )
	// The cell in red
	Cim.drawCells( 1, "AA0000" )
}

function timestep(){
	// Update the grid with one MCS
	C.timeStep()
	meter.tick()
	draw()
	ts = requestAnimationFrame( timestep )
}

function initialize(){
	// Create a new CPM, canvas, and stats object
	C = new CPM.CA( [w,w], {
		"UPDATE_RULE": 	function(p,N){
			let nalive = 0
			for( let pn of N ){
				nalive += (this.pixt(pn)==1)
			}	
			if( this.pixt(p) == 1 ){
				if( nalive == 2 || nalive == 3 ){
					return 1
				}
			} else {
				if( nalive == 3 ) return 1
			}
			return 0
		}
	})

	Cim = new CPM.Canvas( C, {zoom:zoom} )

	// Initialize grid
	for( let x = 0 ; x < w ; x ++ ){
		for( let y = 0 ; y < w ; y ++ ){
			if( C.random() < 0.5 ){
				C.setpix( [x,y], 1 )
			}
		}
	}

	// Start simulation
	meter = new FPSMeter({left:"auto", right:"5px"})
	timestep()
}
</script>
</head>
<body onload="initialize()">

<p>Conway's Game of Life with random initial conditions.</p>

</body>
</html>
